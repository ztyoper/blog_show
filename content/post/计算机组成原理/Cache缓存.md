---
title: "Cache缓存"
date: "2025-02-15T12:01:32+08:00"
slug: "Cache缓存"
categories:
  - "计算机组成原理"
---

### 3.5.2.Cache 与主存的映射方式

#### 1.三种映射方式![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701432302807-5b42e66a-92d7-41b7-ad5e-8ecd643733f3.png)

#### 2.全相联映射

> 组相联映射如果是”2 路组相联“则每组有两个 Cache 块组成。

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701432454443-756ef3a8-5205-4b02-b763-878548ad5d1f.png)

> 图中：每个 Cache 块都有有效位和标记两个属性。
>
> 标记：9 表示主存中第 9 块存储在 Cache 中。
>
> 有效位:1 表示有效，0 表示无效。图中第 7 个 Cache 块标记为 0，但是有效位是 1，相当于主存第 0 块存储在第 7 个 Cache 块中。这也是为什么要设计有效位。

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701432631135-39adbd99-44e7-4949-952a-e590f72bd017.png)

> - 主存大小 256MB=$ 2^8 \* 2^{20} $= $ 2^{28} $个存储单元 0~$ 2^{28}-1 $28 个地址位。
> - 将主存按照一个 Cache 块的大小进行分块，因为 Cache 与主存的交互是以 `块`为单位的。
> - 8 个 Cache 行就是 8 个 Cache 块，为了避免 Cache 块与主存块混淆，以下都是用 Cache 行作为称呼。
> - 行长可以理解为 Cache 块的大小，主存块大小与 Cache 块的大小相等，主存块以每个字节为单位，总共 64 个单位，需要 6 位块内地址。
> - 剩余的 22 个地址为作为标记位，全相联中 Cache 块的标记位要有和主存单元总个数相同的大小。

`CPU访问主存地址`:

1. 首先已知第$ 2^{22}-3 $个主存块存储在第 1 行 Cache;第 0 个主存块存储在第 3 行 Cache 中。
2. CPU 访问存储单元 `1...1101`001110
   1. 主存地址都前 22 位...后续直接看图好不好。

#### 3.直接相联映射

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701433904003-fecbed14-6925-4b76-bc63-075c76b01b76.png)

> - 主存大小 256MB=$ 2^8 \* 2^{20} $= $ 2^{28} $个存储单元 0~$ 2^{28}-1 $28 个地址位。
> - 将主存按照一个 Cache 块的大小进行分块，因为 Cache 与主存的交互是以 `块`为单位的。
> - 行长可以理解为 Cache 块的大小，主存块大小与 Cache 块的大小相等，以每个字节为单位，总共 64 个单位，需要 6 位块内地址。
> - 剩余的 22 个地址为作为标记位，全相联中 Cache 块的标记位要有和主存单元总个数相同的大小。
> - `值得注意的是：标记为22位太多可以优化`：
>   - 因为使用取模的方式固定映射，那么一个 Cache 行可以被多个主存块映射，因此每一个主存块的块号取模的后 3 位都是一样的。例如:能存储到 0 行 Cache 的主存块有 1 号和$ 2^{22}-3 $号，它们取模 3 都是 000。

#### 4.直接相联映射的优化

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701433808674-895a0ad2-93c9-40b6-8ce9-79f1153f3e07.png)

> - 主存大小 256MB=$ 2^8 \* 2^{20} $= $ 2^{28} $个存储单元 0~$ 2^{28}-1 $28 个地址位。
> - 将主存按照一个 Cache 块的大小进行分块，因为 Cache 与主存的交互是以 `块`为单位的。
> - 行长可以理解为 Cache 块的大小，主存块大小与 Cache 块的大小相等，以每个字节为单位，总共 64 个单位，需要 6 位块内地址。
> - 剩余的 19 个地址为作为标记位。3 为作为中间 3 位作为行号。
>   - CPU 查询主存地址是否在 Cache 中存在时，就可以使用 `将访问的存储单元二进制`的中间 3 位行号，先查看对应 Cache 中 `是否`存有数据，也就是有效位 ` 是否为1`。
>   - 设置行号最主要是少了 3 个标记位。节省了空间。

#### 5.组相联映射

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701434594819-6f9c4879-9103-402d-b20d-7d5ab0e8ca9e.png)

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701434774077-d96eecc9-a4bc-4341-a486-1698cfd660d0.png)

> 看懂上面全相联和直接相联就可以看懂组相联了。不想写了
>
> 对组相联的理解：
>
> - 组内随便停车。
> - 融合全相联容易停车的优点和直接相联容易查询的优点。
> - 就是将 2 行 Cache 行合并为 1 组。可以当成一个 Cache 行，这样组相联后续的分析就和直接映射的分析一样了。

#### 6.三种映射方式的总结（优缺点）

![](https://cdn.nlark.com/yuque/0/2023/png/26359226/1701435392612-2e76281c-6ed2-4327-afa9-40fb8f085c53.png)
